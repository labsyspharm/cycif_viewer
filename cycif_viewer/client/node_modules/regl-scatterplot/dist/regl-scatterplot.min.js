!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("pub-sub-es"),require("regl")):"function"==typeof define&&define.amd?define(["exports","pub-sub-es","regl"],n):n((e=e||self).createScatterplot={},e.createPubSub,e.createREGL)}(this,(function(e,n,t){"use strict";function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return t}(e,n)||i(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){if(e){if("string"==typeof e)return a(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,n):void 0}}function a(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var c="undefined"!=typeof Float32Array?Float32Array:Array;function u(){var e=new c(16);return c!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){var n=new c(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function s(e,n){var t=n[0],o=n[1],r=n[2],i=n[3],a=n[4],c=n[5],u=n[6],l=n[7],s=n[8],d=n[9],f=n[10],v=n[11],p=n[12],m=n[13],h=n[14],g=n[15],w=t*c-o*a,y=t*u-r*a,x=t*l-i*a,b=o*u-r*c,S=o*l-i*c,E=r*l-i*u,T=s*m-d*p,A=s*h-f*p,R=s*g-v*p,M=d*h-f*m,C=d*g-v*m,I=f*g-v*h,z=w*I-y*C+x*M+b*R-S*A+E*T;return z?(z=1/z,e[0]=(c*I-u*C+l*M)*z,e[1]=(r*C-o*I-i*M)*z,e[2]=(m*E-h*S+g*b)*z,e[3]=(f*S-d*E-v*b)*z,e[4]=(u*R-a*I-l*A)*z,e[5]=(t*I-r*R+i*A)*z,e[6]=(h*x-p*E-g*y)*z,e[7]=(s*E-f*x+v*y)*z,e[8]=(a*C-c*R+l*T)*z,e[9]=(o*R-t*C-i*T)*z,e[10]=(p*S-m*x+g*w)*z,e[11]=(d*x-s*S-v*w)*z,e[12]=(c*A-a*M-u*T)*z,e[13]=(t*M-o*A+r*T)*z,e[14]=(m*y-p*b-h*w)*z,e[15]=(s*b-d*y+f*w)*z,e):null}function d(e,n,t){var o=n[0],r=n[1],i=n[2],a=n[3],c=n[4],u=n[5],l=n[6],s=n[7],d=n[8],f=n[9],v=n[10],p=n[11],m=n[12],h=n[13],g=n[14],w=n[15],y=t[0],x=t[1],b=t[2],S=t[3];return e[0]=y*o+x*c+b*d+S*m,e[1]=y*r+x*u+b*f+S*h,e[2]=y*i+x*l+b*v+S*g,e[3]=y*a+x*s+b*p+S*w,y=t[4],x=t[5],b=t[6],S=t[7],e[4]=y*o+x*c+b*d+S*m,e[5]=y*r+x*u+b*f+S*h,e[6]=y*i+x*l+b*v+S*g,e[7]=y*a+x*s+b*p+S*w,y=t[8],x=t[9],b=t[10],S=t[11],e[8]=y*o+x*c+b*d+S*m,e[9]=y*r+x*u+b*f+S*h,e[10]=y*i+x*l+b*v+S*g,e[11]=y*a+x*s+b*p+S*w,y=t[12],x=t[13],b=t[14],S=t[15],e[12]=y*o+x*c+b*d+S*m,e[13]=y*r+x*u+b*f+S*h,e[14]=y*i+x*l+b*v+S*g,e[15]=y*a+x*s+b*p+S*w,e}function f(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function v(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function p(e,n,t){var o=n[0],r=n[1],i=n[2],a=n[3];return e[0]=t[0]*o+t[4]*r+t[8]*i+t[12]*a,e[1]=t[1]*o+t[5]*r+t[9]*i+t[13]*a,e[2]=t[2]*o+t[6]*r+t[10]*i+t[14]*a,e[3]=t[3]*o+t[7]*r+t[11]*i+t[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});var m,h;m=new c(4),c!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0,m[3]=0),h=m;!function(){var e=function(){var e=new c(2);return c!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const g=(e=[0,0],n=1,t=0,o=[0,0],r=[0,1/0])=>{const i=new Float32Array(16),a=new Float32Array(16),c=new Float32Array(16);let l=u(),m=[...o.slice(0,2),0,1];const h=[...r],g=()=>function(e,n){var t=n[0],o=n[1],r=n[2],i=n[4],a=n[5],c=n[6],u=n[8],l=n[9],s=n[10];return e[0]=Math.hypot(t,o,r),e[1]=Math.hypot(i,a,c),e[2]=Math.hypot(u,l,s),e}(i,l)[0],w=([e=0,n=0]=[],t=1,o=0)=>{l=u(),y([-e,-n]),b(o),x(1/t)},y=([e=0,n=0]=[])=>{i[0]=e,i[1]=n,i[2]=0;const t=f(a,i);d(l,t,l)},x=(e,n)=>{if(e<=0)return;const t=g(),o=t*e;if(1===(e=Math.max(h[0],Math.min(o,h[1]))/t))return;i[0]=e,i[1]=e,i[2]=1;const r=v(a,i),u=n?[...n,0]:m,p=f(i,u);d(l,p,d(l,r,d(l,s(c,p),l)))},b=e=>{const n=u();!function(e,n,t){var o,r,i,a=t[0],c=t[1],u=t[2],l=Math.hypot(a,c,u);l<1e-6||(a*=l=1/l,c*=l,u*=l,o=Math.sin(n),i=1-(r=Math.cos(n)),e[0]=a*a*i+r,e[1]=c*a*i+u*o,e[2]=u*a*i-c*o,e[3]=0,e[4]=a*c*i-u*o,e[5]=c*c*i+r,e[6]=u*c*i+a*o,e[7]=0,e[8]=a*u*i+c*o,e[9]=c*u*i-a*o,e[10]=u*u*i+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(n,e,[0,0,1]),d(l,n,l)},S=e=>{!e||e.length<16||(l=e)};return w(e,n,t),{get translation(){return function(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}(i,l).slice(0,2)},get target(){return p(i,m,s(c,l)).slice(0,2)},get scaling(){return g()},get scaleBounds(){return[...h]},get distance(){return 1/g()},get rotation(){return Math.acos(l[0]/g())},get view(){return l},get viewCenter(){return m.slice(0,2)},lookAt:w,translate:y,pan:y,rotate:b,scale:x,zoom:x,reset:()=>{w(e,n,t)},set:(...e)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),S(...e)),setScaleBounds:e=>{h[0]=e[0],h[1]=e[1]},setView:S,setViewCenter:e=>{m=[...e.slice(0,2),0,1]}}},w=(e,{distance:n=1,target:t=[0,0],rotation:o=0,isNdc:r=!0,isFixed:i=!1,isPan:a=!0,panSpeed:c=1,isRotate:u=!0,rotateSpeed:l=1,isZoom:s=!0,zoomSpeed:d=1,viewCenter:f,scaleBounds:v,onKeyDown:p=(()=>{}),onKeyUp:m=(()=>{}),onMouseDown:h=(()=>{}),onMouseUp:w=(()=>{}),onMouseMove:y=(()=>{}),onWheel:x=(()=>{})}={})=>{let b=g(t,n,o,f,v),S=!1,E=0,T=0,A=0,R=0,M=!1,C=0,I=0,z=0,P=1,j=1,O=1,k=!1;const L=r?e=>e/P*2*O:e=>e,B=r?e=>e/j*2:e=>-e,D=r?e=>(e/P*2-1)*O:e=>e,F=r?e=>1-e/j*2:e=>e,_=()=>{const n=e.getBoundingClientRect();I=n.top,z=n.left,P=n.width,j=n.height,O=P/j},V=e=>{k=!1,m(e)},q=e=>{k=e.altKey,p(e)},G=e=>{M=!1,w(e)},N=e=>{M=1===e.buttons,h(e)},W=e=>{A=E,R=T,E=e.clientX-z,T=e.clientY-I,y(e)},$=e=>{e.preventDefault();const n=1===e.deltaMode?12:1;C+=n*(e.deltaY||0),x(e)};return window.addEventListener("keydown",q,{passive:!0}),window.addEventListener("keyup",V,{passive:!0}),e.addEventListener("mousedown",N,{passive:!0}),window.addEventListener("mouseup",G,{passive:!0}),window.addEventListener("mousemove",W,{passive:!0}),e.addEventListener("wheel",$,{passive:!1}),_(),b.config=({isFixed:e=null,isPan:n=null,isRotate:t=null,isZoom:o=null,panSpeed:r=null,rotateSpeed:f=null,zoomSpeed:v=null}={})=>{i=null!==e?e:i,a=null!==n?n:a,u=null!==t?t:u,s=null!==o?o:s,c=+r>0?r:c,l=+f>0?f:l,d=+v>0?v:d},b.dispose=()=>{b=void 0,window.removeEventListener("keydown",q),window.removeEventListener("keyup",V),e.removeEventListener("mousedown",N),window.removeEventListener("mouseup",G),window.removeEventListener("mousemove",W),e.removeEventListener("wheel",$)},b.refresh=_,b.tick=()=>{if(i)return!1;if(S=!1,a&&M&&!k&&(b.pan([L(c*(E-A)),B(c*(R-T))]),S=!0),s&&C){const e=d*Math.exp(C/j),n=D(E),t=F(T);b.scale(1/e,[n,t]),S=!0}if(u&&M&&k){const e=P/2,n=j/2,t=A-e,o=n-R,r=E-e,i=n-T,a=function(e,n){var t=e[0],o=e[1],r=n[0],i=n[1],a=Math.sqrt(t*t+o*o)*Math.sqrt(r*r+i*i),c=a&&(t*r+o*i)/a;return Math.acos(Math.min(Math.max(c,-1),1))}([t,o],[r,i]),c=t*i-r*o;b.rotate(l*a*Math.sign(c)),S=!0}return C=0,A=E,R=T,S},b};function y(e,n,t,o,r,i){if(r-o<=t)return;const a=o+r>>1;!function e(n,t,o,r,i,a){for(;i>r;){if(i-r>600){const c=i-r+1,u=o-r+1,l=Math.log(c),s=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*s*(c-s)/c)*(u-c/2<0?-1:1),f=Math.max(r,Math.floor(o-u*s/c+d)),v=Math.min(i,Math.floor(o+(c-u)*s/c+d));e(n,t,o,f,v,a)}const c=t[2*o+a];let u=r,l=i;for(x(n,t,r,o),t[2*i+a]>c&&x(n,t,r,i);u<l;){for(x(n,t,u,l),u++,l--;t[2*u+a]<c;)u++;for(;t[2*l+a]>c;)l--}t[2*r+a]===c?x(n,t,r,l):(l++,x(n,t,l,i)),l<=o&&(r=l+1),o<=l&&(i=l-1)}}(e,n,a,o,r,i%2),y(e,n,t,o,a-1,i+1),y(e,n,t,a+1,r,i+1)}function x(e,n,t,o){b(e,t,o),b(n,2*t,2*o),b(n,2*t+1,2*o+1)}function b(e,n,t){const o=e[n];e[n]=e[t],e[t]=o}function S(e,n,t,o){const r=e-t,i=n-o;return r*r+i*i}const E=e=>e[0],T=e=>e[1];class A{constructor(e,n=E,t=T,o=64,r=Float64Array){this.nodeSize=o,this.points=e;const i=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new i(e.length),c=this.coords=new r(2*e.length);for(let o=0;o<e.length;o++)a[o]=o,c[2*o]=n(e[o]),c[2*o+1]=t(e[o]);y(a,c,o,0,a.length-1,0)}range(e,n,t,o){return function(e,n,t,o,r,i,a){const c=[0,e.length-1,0],u=[];let l,s;for(;c.length;){const d=c.pop(),f=c.pop(),v=c.pop();if(f-v<=a){for(let a=v;a<=f;a++)l=n[2*a],s=n[2*a+1],l>=t&&l<=r&&s>=o&&s<=i&&u.push(e[a]);continue}const p=Math.floor((v+f)/2);l=n[2*p],s=n[2*p+1],l>=t&&l<=r&&s>=o&&s<=i&&u.push(e[p]);const m=(d+1)%2;(0===d?t<=l:o<=s)&&(c.push(v),c.push(p-1),c.push(m)),(0===d?r>=l:i>=s)&&(c.push(p+1),c.push(f),c.push(m))}return u}(this.ids,this.coords,e,n,t,o,this.nodeSize)}within(e,n,t){return function(e,n,t,o,r,i){const a=[0,e.length-1,0],c=[],u=r*r;for(;a.length;){const l=a.pop(),s=a.pop(),d=a.pop();if(s-d<=i){for(let r=d;r<=s;r++)S(n[2*r],n[2*r+1],t,o)<=u&&c.push(e[r]);continue}const f=Math.floor((d+s)/2),v=n[2*f],p=n[2*f+1];S(v,p,t,o)<=u&&c.push(e[f]);const m=(l+1)%2;(0===l?t-r<=v:o-r<=p)&&(a.push(d),a.push(f-1),a.push(m)),(0===l?t+r>=v:o+r>=p)&&(a.push(f+1),a.push(s),a.push(m))}return c}(this.ids,this.coords,e,n,t,this.nodeSize)}}function R(e){var n=typeof e;return null!=e&&("object"==n||"function"==n)}var M="object"==typeof global&&global&&global.Object===Object&&global,C="object"==typeof self&&self&&self.Object===Object&&self,I=M||C||Function("return this")(),z=function(){return I.Date.now()},P=I.Symbol,j=Object.prototype,O=j.hasOwnProperty,k=j.toString,L=P?P.toStringTag:void 0;var B=Object.prototype.toString;var D=P?P.toStringTag:void 0;function F(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":D&&D in Object(e)?function(e){var n=O.call(e,L),t=e[L];try{e[L]=void 0;var o=!0}catch(e){}var r=k.call(e);return o&&(n?e[L]=t:delete e[L]),r}(e):function(e){return B.call(e)}(e)}var _=/^\s+|\s+$/g,V=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,G=/^0o[0-7]+$/i,N=parseInt;function W(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==F(e)}(e))return NaN;if(R(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=R(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(_,"");var t=q.test(e);return t||G.test(e)?N(e.slice(2),t?2:8):V.test(e)?NaN:+e}var $=Math.max,U=Math.min;function H(e,n,t){var o,r,i,a,c,u,l=0,s=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(n){var t=o,i=r;return o=r=void 0,l=n,a=e.apply(i,t)}function p(e){return l=e,c=setTimeout(h,n),s?v(e):a}function m(e){var t=e-u;return void 0===u||t>=n||t<0||d&&e-l>=i}function h(){var e=z();if(m(e))return g(e);c=setTimeout(h,function(e){var t=n-(e-u);return d?U(t,i-(e-l)):t}(e))}function g(e){return c=void 0,f&&o?v(e):(o=r=void 0,a)}function w(){var e=z(),t=m(e);if(o=arguments,r=this,u=e,t){if(void 0===c)return p(u);if(d)return clearTimeout(c),c=setTimeout(h,n),v(u)}return void 0===c&&(c=setTimeout(h,n)),a}return n=W(n)||0,R(t)&&(s=!!t.leading,i=(d="maxWait"in t)?$(W(t.maxWait)||0,n):i,f="trailing"in t?!!t.trailing:f),w.cancel=function(){void 0!==c&&clearTimeout(c),l=0,o=u=r=c=void 0},w.flush=function(){return void 0===c?a:g(z())},w}function Y(e,n,t){var o=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return R(t)&&(o="leading"in t?!!t.leading:o,r="trailing"in t?!!t.trailing:r),H(e,n,{leading:o,maxWait:n,trailing:r})}const K=(e,n,t=window.requestAnimationFrame)=>{let o,r=!1;return(...i)=>{if(o=i,!r)return r=!0,t(()=>{const t=e(...o);r=!1,n&&n(t)})}},{push:X,unshift:Z}=Array.prototype,J=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Q=Float32Array.BYTES_PER_ELEMENT,ee={duplicate(e,n=1,t=1){const o=[],r=new Array(2*n);for(let i=0,a=e.length/n;i<a;i++){const a=i*n;for(let o=0;o<n;o++){const i=e[a+o];r[o]=i,r[o+n]=i*t}X.apply(o,r)}return o},mapElement(e,n,t,o){for(let r=0,i=e.length/t;r<i;r++){const i=n+r*t;e[i]=o(e[i],i,r)}return e},pushElement(e,n,t){const o=new Array(t),r=n*t;for(let n=0;n<t;n++)o[n]=e[r+n];return X.apply(e,o),e},unshiftElement(e,n,t){const o=new Array(t),r=n*t;for(let n=0;n<t;n++)o[n]=e[r+n];return Z.apply(e,o),e},increaseStride(e,n,t,o=0){const r=[],i=new Array(t).fill(o);for(let t=0,o=e.length/n;t<o;t++){const o=t*n;for(let t=0;t<n;t++)i[t]=e[o+t];X.apply(r,i)}return r}},ne=(e,{projection:n=J,model:t=J,view:o=J,points:r=[],widths:i=[],color:a=[.8,.5,0,1],width:c=1,miter:u=1,is2d:l=!1,zPos2d:s=0}={})=>{if(!e)return void console.error("Regl instance is undefined.");let d,f,v,p,m,h,g,w,y,x,b,S=l?2:3;const E=()=>{g=e.buffer(),w=e.buffer(),y={prevPosition:{buffer:()=>g,offset:0,stride:3*Q},currPosition:{buffer:()=>g,offset:3*Q*2,stride:3*Q},nextPosition:{buffer:()=>g,offset:3*Q*4,stride:3*Q},offsetScale:()=>w},x=e.elements(),b=e({attributes:y,depth:{enable:!l},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projection:(e,n)=>e.projection||n.projection,model:(e,n)=>e.model||n.model,view:(e,n)=>e.view||n.view,aspectRatio:({viewportWidth:e,viewportHeight:n})=>e/n,color:()=>a,width:({viewportWidth:e})=>c/e*window.devicePixelRatio,miter:u},elements:()=>x,vert:"\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\nuniform float aspectRatio;\n\nuniform float width;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float offsetScale;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  mat4 projViewModel = projection * view * model;\n  vec4 prevProjected = projViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n}",frag:"\nprecision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},T=()=>{A(),E()},A=()=>{r=null,v=null,p=null,m=null,h=null,g.destroy(),w.destroy(),x.destroy()},R=(e=[],n=i,t=l)=>{r=e,S=(l=t)?2:3,d=Math.floor(r.length/S),f=d+2,n.length===d&&(i=n),r&&r.length>1?(r.length%S>0&&console.warn(`The length of points (${d}) does not match the dimensions (${S}). Incomplete points are ignored.`),v=r.slice(0,d*S),l&&(v=ee.increaseStride(v,2,3,s)),i.length!==d&&(i=new Array(d).fill(1)),ee.pushElement(v,d-1,3),ee.unshiftElement(v,0,3),p=new Float32Array(ee.duplicate(v,3)),m=ee.duplicate(i,1,-1),h=((e,n,t=[])=>{for(let o=0;o<e-1;o++){const e=n+2*o,r=e+1,i=e+2,a=e+3;t.push(e,r,i,i,r,a)}return t})(d,0),g({usage:"dynamic",type:"float",length:3*f*2*Q,data:p}),w({usage:"dynamic",type:"float",length:1*d*2*Q,data:m}),x({primitive:"triangles",usage:"dynamic",type:"uint16",data:h})):T()};return E(),r&&r.length>1&&R(r),{clear:T,destroy:A,draw:({projection:e,model:i,view:a}={})=>{e&&(n=e),i&&(t=i),a&&(o=a),r&&r.length>1&&b({projection:n,model:t,view:o})},getPoints:()=>r,setPoints:R,getData:()=>({points:p,widths:m}),getBuffer:()=>({points:g,widths:w}),getStyle:()=>({color:a,miter:u,width:c}),setStyle:({color:e,miter:n,width:t}={})=>{e&&(a=e),n&&(u=n),+t>0&&(c=t)}}},te="\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",oe="\nprecision mediump float;\n\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = projection * view * model * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",re="\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\n\nvarying vec4 color;\n\nvoid main() {\n  float r = 0.0, delta = 0.0, alpha = 1.0;\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  r = dot(cxy, cxy);\n\n  #ifdef GL_OES_standard_derivatives\n    delta = fwidth(r);\n    alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n  #endif\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",ie='\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float devicePixelRatio;\nuniform sampler2D pointSizeTex;\nuniform float pointSizeTexRes;\nuniform float pointSizeExtra;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByCategory;\nuniform float isColoredByValue;\nuniform float isSizedByCategory;\nuniform float isSizedByValue;\nuniform float maxColorTexIdx;\nuniform float numColorStates;\nuniform float maxPointSizeTexIdx;\nuniform float scaling;\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute float stateIndex;\n\n// variables to send to the fragment shader\nvarying vec4 color;\n\nvoid main() {\n  // First get the state\n  float eps = 0.5 / stateTexRes;\n  float stateRowIndex = floor((stateIndex + eps) / stateTexRes);\n  vec2 stateTexIndex = vec2(\n    (stateIndex / stateTexRes) - stateRowIndex + eps,\n    stateRowIndex / stateTexRes + eps\n  );\n\n  vec4 state = texture2D(stateTex, stateTexIndex);\n\n  gl_Position = projection * view * model * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexCat = state.z * isColoredByCategory;\n  float colorIndexVal = floor(state.w * maxColorTexIdx) * isColoredByValue;\n  float colorIndex = colorIndexCat + colorIndexVal;\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  colorIndex *= numColorStates;\n  // Half a "pixel" or "texel" in texture coordinates\n  eps = 0.5 / colorTexRes;\n  float colorLinearIndex = colorIndex + globalState;\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + eps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + eps,\n    colorRowIndex / colorTexRes + eps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // The final scaling consists of linear scaling in [0, 1] and log scaling\n  // in [1, [\n  float finalScaling = min(1.0, scaling) + log2(max(1.0, scaling));\n\n  // Determine point size\n  float pointSizeIndexCat = state.z * isSizedByCategory;\n  float pointSizeIndexVal = floor(state.w * maxPointSizeTexIdx) * isSizedByValue;\n  float pointSizeIndex = pointSizeIndexCat + pointSizeIndexVal;\n\n  eps = 0.5 / pointSizeTexRes;\n  float pointSizeRowIndex = floor((pointSizeIndex + eps) / pointSizeTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / pointSizeTexRes) - pointSizeRowIndex + eps,\n    pointSizeRowIndex / pointSizeTexRes + eps\n  );\n  float pointSize = texture2D(pointSizeTex, pointSizeTexIndex).x;\n\n  gl_PointSize = pointSize * finalScaling + pointSizeExtra * devicePixelRatio;\n}\n',ae="precision mediump float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",ce="precision mediump float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",ue=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1;var le=Float32Array.BYTES_PER_ELEMENT,se=["OES_standard_derivatives","OES_texture_float"],de={cubicIn:e=>e*e*e,cubicInOut:ue,cubicOut:e=>--e*e*e+1,linear:e=>e,quadIn:e=>e*e,quadInOut:e=>e<.5?2*e*e:(4-2*e)*e-1,quadOut:e=>e*(2-e)},fe=ue,ve=["deselect","lassoEnd"],pe=[6],me=[.66,.66,.66,1],he=[0,.55,1,1],ge=[1,1,1,1],we=[0,0,0,1],ye=[0,0],xe=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),be=[0,.666666667,1,1],Se=[1,1,1,.5],Ee=function(e,n){return e>n?e:n},Te=function(e){return!!e&&se.reduce((function(n,t){return e.hasExtension(t)?n:(console.warn("WebGL: ".concat(t," extension not supported. Scatterplot might not render properly")),!1)}),!0)},Ae=function(e){var n=e.getContext("webgl"),o=[];return se.forEach((function(e){n.getExtension(e)?o.push(e):console.warn("WebGL: ".concat(e," extension not supported. Scatterplot might not render properly"))})),t({gl:n,extensions:o})},Re=function(e,n,t,o){return Math.sqrt(Math.pow(e-t,2)+Math.pow(n-o,2))},Me=function(e){for(var n=1/0,t=-1/0,o=1/0,r=-1/0,i=0;i<e.length;i+=2)n=e[i]<n?e[i]:n,t=e[i]>t?e[i]:t,o=e[i+1]<o?e[i+1]:o,r=e[i+1]>r?e[i+1]:r;return[n,o,t,r]},Ce=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,n,t,o){return"#".concat(n).concat(n).concat(t).concat(t).concat(o).concat(o)})).substring(1).match(/.{2}/g).map((function(e){return parseInt(e,16)/Math.pow(255,n)}))},Ie=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.minLength,r=void 0===o?0:o;return Array.isArray(e)&&e.length>=r&&e.every(n)},ze=function(e){return!Number.isNaN(+e)&&+e>0},Pe=function(e,n){return function(t){return e.indexOf(t)>=0?t:n}},je=function(e,n){return new Promise((function(t,o){(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(t,o){var r=new Image;n&&(r.crossOrigin="anonymous"),r.src=e,r.onload=function(){t(r)},r.onerror=function(e){o(e)}}))})(n,0!==n.indexOf(window.location.origin)&&-1===n.indexOf("base64")).then((function(n){t(e.texture(n))})).catch((function(e){o(e)}))}))},Oe=function(e){return e>=0&&e<=1},ke=function(e){return Array.isArray(e)&&e.every(Oe)},Le=function(){for(var e,n,t,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=o(i,2),c=a[0],u=a[1],l=arguments.length>1?arguments[1]:void 0,s=!1,d=0,f=l.length-2;d<l.length;d+=2)e=l[d],n=l[d+1],t=l[f],n>u!=(r=l[f+1])>u&&c<(t-e)*(u-n)/(r-n)+e&&(s=!s),f=d;return s},Be=function(e){return"string"==typeof e||e instanceof String},De=function(e){return Number.isInteger(e)&&e>=0&&e<=255},Fe=function(e){return Array.isArray(e)&&e.every(De)},_e=function(e){return Array.isArray(e)&&e.length&&(Array.isArray(e[0])||Be(e[0]))},Ve=function(e,n){return e>n?e:n},qe=function(e,n){return e<n?e:n},Ge=function(e){return e.map((function(n){return n/e.reduce(Ee,-1/0)}))},Ne=function(e,n){return 4===(t=e).length&&(ke(t)||Fe(t))?n&&!ke(e)?Ge(e):e:3===(o=e).length&&(ke(o)||Fe(o))?[].concat(r(n?Ge(e):e),[Math.pow(255,!n)]):/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[].concat(r(Ce(e,n)),[Math.pow(255,!n)])}(e,n):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),n?[1,1,1,1]:[255,255,255,255]);var t,o},We={background:"backgroundColor",target:"cameraTarget",distance:"cameraDistance",rotation:"cameraRotation",view:"cameraView"},$e=function(e){Object.keys(e).filter((function(e){return We[e]})).forEach((function(e){console.warn('regl-scatterplot: the "'.concat(e,'" property is deprecated. Please use "').concat(We[e],'" instead.'))}))};e.createRegl=Ae,e.createTextureFromUrl=je,e.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n({async:!e.syncEvents,caseInsensitive:!0}),i=new Float32Array(16),a=[0,0];$e(e);var c=e.regl,u=e.background,f=e.backgroundColor,m=e.backgroundImage,h=void 0===m?null:m,g=e.cameraTarget,y=e.cameraDistance,x=e.cameraRotation,b=e.cameraView,S=e.canvas,E=void 0===S?document.createElement("canvas"):S,T=e.colorBy,R=void 0===T?null:T,M=e.deselectOnDblClick,C=void 0===M||M,I=e.deselectOnEscape,z=void 0===I||I,P=e.lassoColor,j=void 0===P?be:P,O=e.lassoMinDelay,k=void 0===O?10:O,L=e.lassoMinDist,B=void 0===L?3:L,D=e.lassoClearEvent,F=void 0===D?"lassoEnd":D,_=e.showRecticle,V=void 0!==_&&_,q=e.recticleColor,G=void 0===q?Se:q,N=e.pointColor,W=void 0===N?me:N,$=e.pointColorActive,U=void 0===$?he:$,H=e.pointColorHover,X=void 0===H?ge:H,Z=e.pointSize,J=void 0===Z?pe:Z,Q=e.pointSizeSelected,ee=void 0===Q?2:Q,ue=e.pointOutlineWidth,se=void 0===ue?2:ue,Ee=e.sizeBy,Ce=void 0===Ee?null:Ee,Oe=e.width,ke=void 0===Oe?100:Oe,De=e.height,Fe=void 0===De?100:De,Ge=e.target,We=e.distance,Ue=e.rotation,He=e.view;Te(c);var Ye,Ke,Xe,Ze,Je,Qe,en,nn,tn,on,rn,an,cn=Ne(f||u||we,!0),un=null,ln=E,sn=ke,dn=Fe,fn=Ie(J,ze,{minLength:1})?r(J):[J],vn=ee,pn=se,mn=c||Ae(E),hn=!1,gn=!1,wn=[0,0],yn=0,xn=[],bn=Ne(j,!0),Sn=+k,En=+B,Tn=F,An=[],Rn=[],Mn=1,Cn=V,In=Ne(G,!0),zn=C,Pn=z,jn=_e(W)?r(W):[W],On=_e(U)?r(U):[U],kn=_e(X)?r(X):[X];jn=jn.map((function(e){return Ne(e,!0)})),On=On.map((function(e){return Ne(e,!0)})),kn=kn.map((function(e){return Ne(e,!0)}));var Ln,Bn,Dn,Fn,_n,Vn,qn=0,Gn=!1,Nn=null,Wn=null,$n=Cn,Un=0,Hn=0,Yn=R,Kn=Ce,Xn=!1,Zn=!1,Jn=1,Qn=!1,et=e.xScale||null,nt=e.yScale||null,tt=0,ot=0,rt=0,it=0;et&&(tt=et.domain()[0],ot=et.domain()[1]-et.domain()[0],et.range([0,sn])),nt&&(rt=nt.domain()[0],it=nt.domain()[1]-nt.domain()[0],nt.range([dn,0]));var at=function(){return a.slice()},ct=function(e){return e/sn*2-1},ut=function(e){return 1+e/dn*-2},lt=function(){return[ct(a[0]),ut(a[1])]},st=function(e,n){var t=[e,n,1,1];return p(t,t,s(i,d(i,Je,d(i,Ye.view,Qe)))),t.slice(0,2)},dt=function(){var e,n=o(lt(),2),t=n[0],r=n[1],i=o(st(t,r),2),a=i[0],c=i[1],u=Ye.scaling,l=2*fn*(qe(1,u)+Math.log2(Ve(1,u)))*window.devicePixelRatio,s=l/sn,d=l/dn,f=Ze.range(a-s,c-d,a+s,c+d),v=l;return f.forEach((function(n){var t=o(Ze.points[n],2),r=t[0],i=t[1],u=Re(r,i,a,c);u<v&&(v=u,e=n)})),v<fn/sn*2?e:-1},ft=function(){var e=at(),n=o(lt(),2),i=n[0],a=n[1];if(Xe){if(Re.apply(void 0,r(e).concat(r(Xe)))>En){var c,u=st(i,a);(c=An).push.apply(c,r(u)),Rn.push(u),Xe=e,An.length>2&&Ke.setPoints(An)}}else{var l=st(i,a);An=r(l),Rn=[l],Xe=e}t.publish("lassoExtend",{coordinates:Rn})},vt=Y(ft,Sn),pt=function(e){var n,t=Me(e),o=(n=Ze).range.apply(n,r(t)),i=[];return o.forEach((function(n){Le(Ze.points[n],e)&&i.push(n)})),i},mt=function(){An=[],Rn=[],Ke&&Ke.clear()},ht=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.preventEvent,o=void 0!==n&&n;"deselect"===Tn&&mt(),xn.length&&(o||t.publish("deselect"),xn=[],zo())},gt=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.preventEvent,r=void 0!==o&&o;xn=e,Bn({usage:"dynamic",type:"float",data:new Float32Array(xn)}),r||t.publish("select",{points:xn}),zo()},wt=function(e){var n=ln.getBoundingClientRect();return a[0]=e.clientX-n.left,a[1]=e.clientY-n.top,[].concat(a)},yt=function(){Ye.config({isFixed:!0}),Xe=void 0,mt(),t.publish("lassoStart")},xt=function(){Ye.config({isFixed:!1});var e=pt(An);gt(e),Xe=void 0,t.publish("lassoEnd",{coordinates:Rn}),"lassoEnd"===Tn&&mt()},bt=function(e){Zn&&(hn=!0,wn=wt(e),(gn=e.shiftKey)&&yt())},St=function(){Zn&&(hn=!1,gn&&(gn=!1,xt()))},Et=function(e){if(Zn){var n=wt(e);if(!(Re.apply(void 0,r(n).concat(r(wn)))>=En)){var t=dt();t>=0&&gt([t])}}},Tt=function(){zn&&ht()},At=function(e){if(Zn&&(Qn||hn)){if(wt(e),Qn&&!gn){var n=dt();tr(n)}gn&&vt(),hn&&zo()}},Rt=function(){Zn&&(Vn=void 0,Qn=!1,St(),zo())},Mt=function(){var e=fn.length;Hn=Math.max(2,Math.ceil(Math.sqrt(e)));var n=new Float32Array(4*Math.pow(Hn,2));return fn.forEach((function(e,t){n[4*t]=e})),mn.texture({data:n,shape:[Hn,Hn,4],type:"float"})},Ct=function(){var e=jn.length,n=On.length,t=kn.length,o=[];if(e===n&&n===t)for(var r=0;r<e;r++)o.push(jn[r],On[r],kn[r],cn);else for(var i=0;i<e;i++){var a=[jn[i][0],jn[i][1],jn[i][2],1],c=null===Yn?On[0]:a,u=null===Yn?kn[0]:a;o.push(jn[i],c,u,cn)}return o},It=function(){var e=Ct(),n=e.length;Un=Math.max(2,Math.ceil(Math.sqrt(n)));var t=new Float32Array(4*Math.pow(Un,2));return e.forEach((function(e,n){t[4*n]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=n%4>0||1===Jn?e[3]:Jn})),mn.texture({data:t,shape:[Un,Un,4],type:"float"})},zt=function(){Je=v([],[1/(sn/dn),1,1]),Qe=v([],[Mn,1,1])},Pt=function(e){+e<=0||(Mn=e)},jt=function(e,n){return function(t){if(t&&t.length){var o=r(e()),i=_e(t)?t:[t];i=i.map((function(e){return Ne(e,!0)})),Fn&&Fn.destroy();try{n(i),Fn=It()}catch(e){console.error("Invalid colors. Switching back to default colors."),n(o),Fn=It()}}}},Ot=jt((function(){return jn}),(function(e){jn=e})),kt=jt((function(){return On}),(function(e){On=e})),Lt=jt((function(){return kn}),(function(e){kn=e})),Bt=function(){var e=st(-1,-1),n=st(1,1),t=(e[0]+1)/2,o=(n[0]+1)/2,r=(e[1]+1)/2,i=(n[1]+1)/2;return[[tt+t*ot,tt+o*ot],[rt+r*it,rt+i*it]]},Dt=function(){if(et||nt){var e=o(Bt(),2),n=e[0],t=e[1];et&&et.domain(n),nt&&nt.domain(t)}},Ft=function(e){!+e||+e<=0||(dn=+e,ln.height=dn*window.devicePixelRatio,nt&&(nt.range([dn,0]),Dt()))},_t=function(e){Ie(e,ze,{minLength:1})&&(fn=r(e)),ze(+e)&&(fn=[+e]),_n=Mt()},Vt=function(e){!+e||+e<0||(vn=+e)},qt=function(e){!+e||+e<0||(pn=+e)},Gt=function(e){!+e||+e<=0||(sn=+e,ln.width=sn*window.devicePixelRatio,et&&(et.range([0,sn]),Dt()))},Nt=function(e){switch(e){case"category":Yn="category";break;case"value":Yn="value";break;default:Yn=null}},Wt=function(e){!+e||+e<=0||(Jn=+e,Fn&&Fn.destroy(),Fn=It())},$t=function(e){switch(e){case"category":Kn="category";break;case"value":Kn="value";break;default:Kn=null}},Ut=function(){return un},Ht=function(){return Fn},Yt=function(){return Un},Kt=function(){return window.devicePixelRatio},Xt=function(){return Ln},Zt=function(){return Bn},Jt=function(){return _n},Qt=function(){return Hn},eo=function(){return 0},no=function(){return rn||tn},to=function(){return qn},oo=function(){return Je},ro=function(){return Ye.view},io=function(){return Qe},ao=function(){return Ye.scaling},co=function(){return yn},uo=function(){return 1*("category"===Yn)},lo=function(){return 1*("value"===Yn)},so=function(){return 1*("category"===Kn)},fo=function(){return 1*("value"===Kn)},vo=function(){return jn.length-1},po=function(){return fn.length},mo=mn({framebuffer:function(){return an},vert:ce,frag:ae,attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:function(){return on},endStateTex:function(){return tn},t:function(e,n){return n.t}},count:3}),ho=function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return mn({frag:re,vert:ie,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:t,size:1}},uniforms:{projection:oo,model:io,view:ro,devicePixelRatio:Kt,scaling:ao,pointSizeTex:Jt,pointSizeTexRes:Qt,pointSizeExtra:e,globalState:o,colorTex:Ht,colorTexRes:Yt,stateTex:no,stateTexRes:to,isColoredByCategory:uo,isColoredByValue:lo,isSizedByCategory:so,isSizedByValue:fo,maxColorTexIdx:vo,numColorStates:4,maxPointSizeTexIdx:po},count:n,primitive:"points"})},go=ho(eo,co,Xt),wo=ho(eo,(function(){return 1}),(function(){return Dn}),2),yo=function(){var e=xn.length;ho((function(){return(vn+2*pn)*window.devicePixelRatio}),(function(){return e}),Zt,1)(),ho((function(){return(vn+pn)*window.devicePixelRatio}),(function(){return e}),Zt,3)(),ho((function(){return vn}),(function(){return e}),Zt,1)()},xo=mn({frag:te,vert:oe,attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{projection:oo,model:io,view:ro,texture:Ut},count:6}),bo=mn({vert:"\n      precision mediump float;\n      uniform mat4 projection;\n      uniform mat4 model;\n      uniform mat4 view;\n      attribute vec2 position;\n      void main () {\n        gl_Position = projection * view * model * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:function(){return Rn}},uniforms:{projection:oo,model:io,view:ro,color:function(){return bn}},elements:function(){return Array(Rn.length-2).fill().map((function(e,n){return[0,n+1,n+2]}))}}),So=function(){if(Vn>=0){var e=o(Ze.points[Vn].slice(0,2),2),n=[e[0],e[1],0,1];d(i,Je,d(i,Ye.view,Qe)),p(n,n,i),en.setPoints([-1,n[1],1,n[1]]),nn.setPoints([n[0],1,n[0],-1]),en.draw(),nn.draw(),ho((function(){return(vn+2*pn)*window.devicePixelRatio}),(function(){return 1}),Dn,1)(),ho((function(){return(vn+pn)*window.devicePixelRatio}),(function(){return 1}),Dn,3)()}},Eo=function(e){for(var n=new Float32Array(e),t=0;t<e;++t)n[t]=t;return n},To=function(e){var n=e.length;qn=Math.max(2,Math.ceil(Math.sqrt(n)));for(var t=new Float32Array(4*Math.pow(qn,2)),o=0;o<n;++o)t[4*o]=e[o][0],t[4*o+1]=e[o][1],t[4*o+2]=e[o][2]||0,t[4*o+3]=e[o][3]||0;return mn.texture({data:t,shape:[qn,qn,4],type:"float"})},Ao=function(e){if(!tn)return!1;if(Gn){var n=on;on=rn,n.destroy()}else on=tn;return rn=To(e),an=mn.framebuffer({color:rn,depth:!1,stencil:!1}),tn=void 0,!0},Ro=function(){on&&(on.destroy(),on=void 0),rn&&(rn.destroy(),rn=void 0)},Mo=function(e){Zn=!1,yn=e.length,tn&&tn.destroy(),tn=To(e),Ln({usage:"static",type:"float",data:Eo(yn)}),Ze=new A(e,(function(e){return e[0]}),(function(e){return e[1]}),16),Zn=!0},Co=function(e){Zn&&mn&&(mn.clear({color:[0,0,0,0],depth:1}),Xn=Ye.tick(),un&&xo(),go(),hn||!Cn&&!e||So(),Vn>=0&&wo(),xn.length&&yo(),Rn.length>2&&bo(),Ke.draw({projection:oo(),model:io(),view:ro()}),Xn&&(Dt(),t.publish("view",{view:Ye.view,camera:Ye,xScale:et,yScale:nt})))},Io=function(){return t.publish("draw")},zo=K(Co,Io),Po=function(e,n,o){Nn||(Nn=performance.now());var r=performance.now()-Nn;return mo({t:Math.min(1,Math.max(0,n(r/e)))}),Co.apply(o),t.publish("draw"),r<e},jo=function(){Gn=!1,Nn=null,Cn=$n,Ro(),t.publish("transitionEnd")},Oo=function e(n,t,o){Wn=window.requestAnimationFrame((function(){Po(n,t,o)?e(n,t,o):jo()}))},ko=function(e){var n=e.duration,o=void 0===n?500:n,r=e.easing,i=void 0===r?fe:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=Be(i)?de[i]||fe:i;Gn&&(t.publish("transitionEnd"),window.cancelAnimationFrame(Wn)),Gn=!0,Nn=null,$n=Cn,Cn=!1,Oo(o,c,a),t.publish("transitionStart")},Lo=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(o){var r=!1;e&&(n.transition&&(e.length===yn?r=Ao(e):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),Mo(e)),Oo&&r?(t.subscribe("transitionEnd",o,1),ko({duration:n.transitionDuration,easing:n.transitionEasing},[n.showRecticleOnce])):(t.subscribe("draw",o,1),zo(n.showRecticleOnce))}))},Bo=function(e){return function(){var n=e.apply(void 0,arguments);return zo(),n}},Do=function(e){e&&(cn=Ne(e,!0))},Fo=function(e){e?Be(e)?je(mn,e).then((function(e){un=e,zo(),t.publish("backgroundImageReady")})):un=e:un=null},_o=function(e){e>0&&Ye.lookAt(Ye.target,e,Ye.rotation)},Vo=function(e){null!==e&&Ye.lookAt(Ye.target,Ye.distance,e)},qo=function(e){e&&Ye.lookAt(e,Ye.distance,Ye.rotation)},Go=function(e){e&&Ye.setView(e)},No=function(e){e&&(bn=Ne(e,!0),Ke.setStyle({color:bn}))},Wo=function(e){+e&&(vt=Y(ft,Sn=+e))},$o=function(e){+e&&(En=+e)},Uo=function(e){Tn=Pe(ve,Tn)(e)},Ho=function(e){null!==e&&(Cn=e)},Yo=function(e){e&&(In=Ne(e,!0),en.setStyle({color:In}),nn.setStyle({color:In}))},Ko=function(e){e&&(et=e,tt=e.domain()[0],ot=e?e.domain()[1]-e.domain()[0]:0)},Xo=function(e){e&&(rt=(nt=e).domain()[0],it=nt?nt.domain()[1]-nt.domain()[0]:0)},Zo=function(e){zn=!!e},Jo=function(e){Pn=!!e},Qo=function(){mn.poll(),Ye.refresh()},er=function(e){return $e({property:!0}),"aspectRatio"===e?Mn:"background"===e||"backgroundColor"===e?cn:"backgroundImage"===e?un:"camera"===e?Ye:"cameraTarget"===e?Ye.target:"cameraDistance"===e?Ye.distance:"cameraRotation"===e?Ye.rotation:"cameraView"===e?Ye.view:"canvas"===e?ln:"colorBy"===e?Yn:"sizeBy"===e?Kn:"deselectOnDblClick"===e?zn:"deselectOnEscape"===e?Pn:"height"===e?dn:"lassoColor"===e?bn:"lassoMinDelay"===e?Sn:"lassoMinDist"===e?En:"lassoClearEvent"===e?Tn:"opacity"===e?Jn:"pointColor"===e?1===jn.length?jn[0]:jn:"pointColorActive"===e?1===On.length?On[0]:On:"pointColorHover"===e?1===kn.length?kn[0]:kn:"pointOutlineWidth"===e?pn:"pointSize"===e?fn:"pointSizeSelected"===e?vn:"recticleColor"===e?In:"regl"===e?mn:"showRecticle"===e?Cn:"version"===e?"0.14.0":"width"===e?sn:"xScale"===e?et:"yScale"===e?nt:void 0},nr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$e(e),void 0===e.backgroundColor&&void 0===e.background||Do(e.backgroundColor||e.background),void 0!==e.backgroundImage&&Fo(e.backgroundImage),void 0!==e.cameraTarget&&qo(e.cameraTarget),void 0!==e.cameraDistance&&_o(e.cameraDistance),void 0!==e.cameraRotation&&Vo(e.cameraRotation),void 0!==e.cameraView&&Go(e.cameraView),void 0!==e.colorBy&&Nt(e.colorBy),void 0!==e.pointColor&&Ot(e.pointColor),void 0!==e.pointColorActive&&kt(e.pointColorActive),void 0!==e.pointColorHover&&Lt(e.pointColorHover),void 0!==e.pointSize&&_t(e.pointSize),void 0!==e.pointSizeSelected&&Vt(e.pointSizeSelected),void 0!==e.sizeBy&&$t(e.sizeBy),void 0!==e.opacity&&Wt(e.opacity),void 0!==e.lassoColor&&No(e.lassoColor),void 0!==e.lassoMinDelay&&Wo(e.lassoMinDelay),void 0!==e.lassoMinDist&&$o(e.lassoMinDist),void 0!==e.lassoClearEvent&&Uo(e.lassoClearEvent),void 0!==e.showRecticle&&Ho(e.showRecticle),void 0!==e.recticleColor&&Yo(e.recticleColor),void 0!==e.pointOutlineWidth&&qt(e.pointOutlineWidth),void 0!==e.height&&Ft(e.height),void 0!==e.width&&Gt(e.width),void 0!==e.aspectRatio&&Pt(e.aspectRatio),void 0!==e.xScale&&Ko(e.xScale),void 0!==e.yScale&&Xo(e.yScale),void 0!==e.deselectOnDblClick&&Zo(e.deselectOnDblClick),void 0!==e.deselectOnEscape&&Jo(e.deselectOnEscape),zt(),Ye.refresh(),Qo(),zo()},tr=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!1;if(e>=0){o=!0;var r=e!==Vn;Vn=e,Dn.subdata([e]),r&&t.publish("pointover",Vn)}else o=Vn,Vn=void 0,+o>=0&&t.publish("pointout",o);o&&zo(null,n)},or=function(){Ye||(Ye=w(ln)),b||He?Ye.setView(l(b||He)):g||Ge||y||We||x||Ue?Ye.lookAt(r(g||Ge||ye),y||We||1,x||Ue||0):Ye.setView(l(xe))},rr=function(){or(),Dt(),t.publish("view",{view:Ye.view,camera:Ye,xScale:et,yScale:nt})},ir=function(e){switch(e.key){case"Escape":Pn&&ht()}},ar=function(){Qn=!0},cr=function(){tr(),Qn=!1,zo()},ur=function(){zo()},lr=function(){Mo([])},sr=function(){zt(),or(),Dt(),Ke=ne(mn,{color:bn,width:3,is2d:!0}),en=ne(mn,{color:In,width:1,is2d:!0}),nn=ne(mn,{color:In,width:1,is2d:!0}),ln.addEventListener("wheel",ur),Ln=mn.buffer(),Bn=mn.buffer(),Dn=mn.buffer({usage:"dynamic",type:"float",length:le}),Fn=It(),_n=Mt(),nr({backgroundImage:h,width:sn,height:dn}),window.addEventListener("keyup",ir,!1),window.addEventListener("blur",Rt,!1),window.addEventListener("mouseup",St,!1),window.addEventListener("mousemove",At,!1),ln.addEventListener("mousedown",bt,!1),ln.addEventListener("mouseenter",ar,!1),ln.addEventListener("mouseleave",cr,!1),ln.addEventListener("click",Et,!1),ln.addEventListener("dblclick",Tt,!1)},dr=function(){window.removeEventListener("keyup",ir,!1),window.removeEventListener("blur",Rt,!1),window.removeEventListener("mouseup",St,!1),window.removeEventListener("mousemove",At,!1),ln.removeEventListener("mousedown",bt,!1),ln.removeEventListener("mouseenter",ar,!1),ln.removeEventListener("mouseleave",cr,!1),ln.removeEventListener("click",Et,!1),ln.removeEventListener("dblclick",Tt,!1),ln=void 0,Ye=void 0,mn=void 0,Ke.destroy(),t.clear()};return sr(),{clear:Bo(lr),createTextureFromUrl:function(e){return je(mn,e)},deselect:ht,destroy:dr,draw:Lo,get:er,hover:tr,refresh:Qo,reset:Bo(rr),select:gt,set:nr,subscribe:t.subscribe,unsubscribe:t.unsubscribe}},Object.defineProperty(e,"__esModule",{value:!0})}));
