(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global.withRaf = factory());
}(this, (function () { 'use strict';

  /**
   * Higher order function for request animation frame-based throttling. If you
   * call the wrapped function multiple times, the last argument will be used the
   * next time a frame is available.
   * @param {function} fn - Function to be throttled
   * @param {function} onCall - Callback function, which is triggered with the
   *   return value of `fn`.
   * @param {function} raf - Request animation frame polyfill. Defaults to
   *   `window.requestAnimationFrame`.
   * @return {function} Throttled function `fn` which returns the request ID that
   *   can be used to cancel the request.
   */
  var withRaf = function (fn, onCall, raf) {
    if ( raf === void 0 ) raf = window.requestAnimationFrame;

    var isRequesting = false;
    var requestedArgs;
    return function () {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

      requestedArgs = args;
      if (isRequesting) { return undefined; }
      isRequesting = true;
      return raf(function () {
        var response = fn.apply(void 0, requestedArgs);
        isRequesting = false;
        if (onCall) { onCall(response); }
      });
    };
  };

  return withRaf;

})));
